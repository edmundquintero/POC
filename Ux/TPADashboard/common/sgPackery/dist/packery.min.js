/*!
 * angular-packery
 * http://github.com/sungard-labs/angular-packery
 * Version: 0.2.2
 * License: MIT
 */

"use strict";angular.module("angular-packery",["template/packery/packery.html"]).constant("packeryConfig",{columnWidth:"packery-sizer",itemSelector:"packery-object, .packery-object, [packery-object]",rowHeight:"packery-sizer",draggable:!0,handle:"*",timeout:2e3,acceptedAttributes:["containerStyle","columnWidth","gutter","isHorizontal","isInitLayout","isOriginLeft","isOriginTop","isResizeBound","itemSelector","rowHeight","transitionDuration"]}).service("packeryService",["$rootScope","$q","$interval","$timeout","packeryConfig",function(a,b,c,d,e){var f,g=[],h=function(a,b){for(var c=0;c<b.length;c++)if(b[c].id===a)return!1;return!0};return{Packery:function(i,j,k){var l=b.defer();if(j=j||void 0,k=k||{},h(i,g)&&void 0!==j)return f=new Packery(j[0],k),g.push({id:i,packery:f}),a.$emit("packeryInstantiated",f),f;var m=c(function(){void 0!==f&&(c.cancel(m),l.resolve(f))},e.timeout/10);return d(function(){c.cancel(m),l.reject(!1)},e.timeout),l.promise}}}]).controller("PackeryController",["$rootScope","packeryConfig","packeryService",function(a,b,c){var d=this;d.packeryInstantiated=!1,d.packeryDraggable=!1,d.dragHandle=void 0,d.uniqueId=(new Date).getTime(),d.packery={},this.bindDragEvents=function(a){var b,c,e;b=d.dragHandle,"*"===b?(e=new Draggabilly(a[0]),c=a):(e=new Draggabilly(a[0],{handle:b}),c=a.find(b)),d.packery.bindDraggabillyEvents(e),c.on("mouseenter",function(){a.addClass("hovered")}).on("mouseleave",function(){a.removeClass("hovered")})},this.createAttrObj=function(a){for(var c={},d=b.acceptedAttributes,e=0;e<d.length;e++){var f=a[d[e]];void 0!==f&&(c[d[e]]="null"===f?null:isNaN(f)===!1?+a[d[e]]:a[d[e]])}return c},this.packObject=function(b){var e=c.Packery(d.uniqueId);e.then(function(){var c=d.packery.getItemElements();-1===c.indexOf(b[0])&&d.packery.appended(b[0]),d.packeryDraggable===!0&&d.bindDragEvents(b),b.css("visibility","visible"),a.$emit("packeryObjectPacked",b[0])})},this.setDraggable=function(a){d.packeryDraggable=!0,d.dragHandle=a}}]).directive("packery",["packeryConfig","packeryService",function(a,b){return{restrict:"EA",controller:"PackeryController",transclude:!0,replace:!1,templateUrl:"template/packery/packery.html",scope:{containerStyle:"@?",columnWidth:"@?",gutter:"@?",isHorizontal:"@?",isInitLayout:"@?",isOriginLeft:"@?",isOriginTop:"@?",isResizeBound:"@?",itemSelector:"@?",rowHeight:"@?",transitionDuration:"@?",draggable:"@?",handle:"@?"},link:function(c,d,e,f){var g,h,i;d.css("display","block"),c.columnWidth=c.columnWidth||a.columnWidth,c.itemSelector=c.itemSelector||a.itemSelector,c.rowHeight=c.rowHeight||a.rowHeight,c.draggable=c.draggable||a.draggable,c.handle=c.handle||a.handle,c.draggable?f.setDraggable(c.handle):angular.noop(),g=f.createAttrObj(c),h=f.uniqueId,i=b.Packery(h,d,g),i instanceof Packery&&(f.packeryInstantiated=!0,f.packery=i)}}}]).directive("packeryObject",[function(){return{require:"^packery",restrict:"EAC",link:function(a,b,c,d){b.css("display","block"),b.css("visibility","hidden"),d.packObject(b)}}}]),angular.module("template/packery/packery.html",[]).run(["$templateCache",function(a){a.put("template/packery/packery.html",'<packery-sizer class="packery-sizer" style="display:block;"></packery-sizer><packery-container class="packery-container" style="display:block;" ng-transclude></packery-container>')}]);